<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <title>ArcherSense Audio Explorer</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tone/14.8.49/Tone.js"></script>
    <style>
        body { background: #121212; color: white; font-family: sans-serif; display: flex; flex-direction: column; align-items: center; padding: 20px; }
        .controls { display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px; margin-bottom: 40px; }
        .theme-card { background: #222; padding: 20px; border-radius: 10px; cursor: pointer; border: 2px solid transparent; text-align: center; }
        .theme-card.active { border-color: #4ade80; background: #2a2a2a; }
        .slider-container { width: 80%; max-width: 600px; margin-top: 20px; }
        input[type=range] { width: 100%; }
        button { padding: 10px 20px; background: #4ade80; border: none; font-size: 1rem; cursor: pointer; border-radius: 5px; margin-top: 20px; }
    </style>
</head>
<body>
    <h1>üîä Audio Feedback Explorer</h1>
    <p>W√§hle ein Thema und simuliere die Bewegung mit dem Slider.</p>

    <div class="controls">
        <div class="theme-card active" onclick="setTheme('MEDICAL')">
            <h3>üè• Medizinisch</h3>
            <p>Rein, Pr√§zise, Sinus</p>
        </div>
        <div class="theme-card" onclick="setTheme('INDUSTRIAL')">
            <h3>üè≠ Industriell</h3>
            <p>Rau, Alarm, S√§gezahn</p>
        </div>
        <div class="theme-card" onclick="setTheme('ORGANIC')">
            <h3>üåø Organisch</h3>
            <p>Weich, Drone, Dreieck</p>
        </div>
    </div>

    <button id="btn-start">Audio Engine Starten</button>

    <div class="slider-container">
        <label>Abweichung vom Ideal (0% = Perfekt, 100% = Falsch)</label>
        <input type="range" id="sim-slider" min="0" max="100" value="100">
        <h2 id="val-display">100% (Weit weg)</h2>
    </div>

    <script>
        // --- AUDIO ENGINE ---
        const AUDIO_THEMES = {
            MEDICAL: { type: "sine", drone: "sine", chord: ["C5", "E5"] },
            INDUSTRIAL: { type: "sawtooth", drone: "square", chord: ["C4", "G4", "C5"] },
            ORGANIC: { type: "triangle", drone: "triangle", chord: ["C4", "E4", "G4", "B4"] }
        };

        let currentTheme = AUDIO_THEMES.MEDICAL;
        let drone, beepOsc;
        let lastBeep = 0;

        document.getElementById('btn-start').onclick = async () => {
            await Tone.start();
            initAudio();
        };

        function initAudio() {
            if(drone) drone.dispose();
            drone = new Tone.FatOscillator({
                type: currentTheme.drone, frequency: 110, spread: 20, count: 3
            }).toDestination();
            drone.volume.value = -Infinity;
            drone.start();
        }

        function setTheme(name) {
            document.querySelectorAll('.theme-card').forEach(c => c.classList.remove('active'));
            event.currentTarget.classList.add('active');
            currentTheme = AUDIO_THEMES[name];
            initAudio();
        }

        // SIMULATION LOOP
        const slider = document.getElementById('sim-slider');
        const display = document.getElementById('val-display');

        setInterval(() => {
            if (Tone.context.state !== 'running') return;

            const val = parseInt(slider.value); // 0 (Gut) bis 100 (Schlecht)
            const proximity = 1 - (val / 100); // 1.0 (Gut) bis 0.0 (Schlecht)
            
            display.innerText = `${val}% (${val < 10 ? 'PERFEKT' : 'Unterwegs'})`;

            // LOGIK:
            if (val < 10) {
                // PERFEKT -> Drone laut, kein Piepen
                drone.volume.rampTo(-10, 0.1);
            } else {
                // UNTERWEGS -> Drone leise, Geigerz√§hler an
                drone.volume.rampTo(-20 - (val/5), 0.1);

                const interval = 800 - (proximity * 700);
                const freq = 200 + (proximity * 600);

                if (Date.now() - lastBeep > interval) {
                    triggerBeep(freq);
                    lastBeep = Date.now();
                }
            }
        }, 50);

        function triggerBeep(freq) {
            const osc = new Tone.Oscillator(freq, currentTheme.type).toDestination();
            osc.start();
            osc.stop("+0.1");
        }
    </script>
</body>
</html>